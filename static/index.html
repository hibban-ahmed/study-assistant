<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Study Assistant</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for scrollbars and font */
    body {
      font-family: 'Inter', sans-serif; /* Using Inter font */
      overflow: hidden; /* Prevent body scroll, let sections handle it */
    }
    textarea, #output {
      /* Custom scrollbar styles */
      scrollbar-width: thin;
      scrollbar-color: #4f46e5 #e5e7eb; /* thumb and track color */
    }
    textarea::-webkit-scrollbar, #output::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-track, #output::-webkit-scrollbar-track {
      background: #e5e7eb; /* Light gray track */
      border-radius: 10px;
    }
    textarea::-webkit-scrollbar-thumb, #output::-webkit-scrollbar-thumb {
      background-color: #4f46e5; /* Indigo thumb */
      border-radius: 10px;
      border: 2px solid #e5e7eb; /* Padding around thumb */
    }
  </style>
</head>
<body class="flex h-screen bg-gray-100 text-gray-800">

  <!-- Sidebar for Model Selection -->
  <div class="sidebar w-20 bg-indigo-800 text-white p-4 flex flex-col items-center justify-center cursor-pointer rounded-r-lg shadow-lg transition-all duration-300 hover:bg-indigo-700" onclick="toggleModel()">
    <span class="text-xs font-semibold uppercase tracking-wider transform -rotate-90 origin-center whitespace-nowrap">Model:</span>
    <span id="modelName" class="text-lg font-bold mt-4 transform -rotate-90 origin-center whitespace-nowrap">Gemini</span>
  </div>

  <!-- Main Content Container -->
  <div class="container flex flex-col flex-1 p-6 space-y-4 overflow-hidden">

    <!-- Study Content Section -->
    <div class="flex-1 bg-white rounded-lg shadow-md p-4 flex flex-col">
      <label for="content" class="text-lg font-semibold mb-2 text-indigo-700">Study Content</label>
      <textarea id="content" rows="10" placeholder="Enter your study content here..."
                class="flex-1 w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-base transition-all duration-200"></textarea>
    </div>

    <!-- Prompt Section -->
    <div class="flex-shrink-0 bg-white rounded-lg shadow-md p-4 flex flex-col">
      <label for="prompt" class="text-lg font-semibold mb-2 text-indigo-700">Prompt</label>
      <textarea id="prompt" rows="5" placeholder="Enter your instruction or prompt for the AI..."
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-base transition-all duration-200"></textarea>
      <button onclick="generate()" id="generateButton"
              class="mt-4 px-6 py-3 bg-indigo-600 text-white font-bold rounded-md shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
        <span id="buttonText">Generate</span>
        <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </button>
    </div>

    <!-- Output Section -->
    <div class="flex-1 bg-white rounded-lg shadow-md p-4 flex flex-col">
      <label for="output" class="text-lg font-semibold mb-2 text-indigo-700">Output</label>
      <div id="output" class="flex-1 w-full p-3 border border-gray-300 rounded-md bg-gray-50 overflow-y-auto text-base leading-relaxed">
        Your AI-generated content will appear here.
      </div>
    </div>

  </div>

  <script>
    // Initialize model state
    let currentModel = "gemini";

    // Function to toggle between Gemini and LLaMA models
    function toggleModel() {
      currentModel = currentModel === "gemini" ? "llama" : "gemini";
      document.getElementById("modelName").textContent = currentModel.charAt(0).toUpperCase() + currentModel.slice(1);
    }

    // Function to handle content generation
    async function generate() {
      const content = document.getElementById("content").value;
      const prompt = document.getElementById("prompt").value;
      const outputDiv = document.getElementById("output");
      const generateButton = document.getElementById("generateButton");
      const buttonText = document.getElementById("buttonText");
      const loadingSpinner = document.getElementById("loadingSpinner");

      // Show loading state
      buttonText.textContent = "Generating...";
      loadingSpinner.classList.remove("hidden");
      generateButton.disabled = true;
      outputDiv.innerHTML = '<p class="text-gray-500">Generating response, please wait...</p>';

      try {
        // Fetch data from your FastAPI backend
        // IMPORTANT: Use a relative path for Vercel deployment
        const res = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content, prompt, model: currentModel })
        });

        // Check if the response was successful
        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.detail || "Network response was not ok");
        }

        const data = await res.json();
        // Display the output. Assuming the backend sends a 'text' field or a string.
        outputDiv.innerHTML = data.output?.text || data.output || "No output received.";

      } catch (error) {
        // Display error message
        outputDiv.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
        console.error("Generation error:", error);
      } finally {
        // Revert loading state
        buttonText.textContent = "Generate";
        loadingSpinner.classList.add("hidden");
        generateButton.disabled = false;
      }
    }
  </script>
</body>
</html>